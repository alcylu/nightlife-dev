---
function highlightJson(code: string): string {
  return code.replace(
    /("(?:\\.|[^"\\])*")\s*(:)|("(?:\\.|[^"\\])*")|(\b\d+(?:\.\d+)?\b)|(\btrue\b|\bfalse\b|\bnull\b)|([{}[\],:])/g,
    (match, key, colon, str, num, bool, punct) => {
      if (key && colon) return `<span class="text-violet-400">${key}</span><span class="text-gray-400">:</span>`;
      if (str) return `<span class="text-emerald-400">${str}</span>`;
      if (num) return `<span class="text-cyan-400">${num}</span>`;
      if (bool) return `<span class="text-amber-400">${bool}</span>`;
      if (punct) return `<span class="text-gray-400">${punct}</span>`;
      return match;
    }
  );
}

function highlightBash(code: string): string {
  // Escape HTML first
  const escaped = code
    .replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;');
  return escaped
    .replace(/^(curl)\b/gm, '<span class="text-cyan-400">$1</span>')
    .replace(/(-H|-d)\b/g, '<span class="text-amber-400">$1</span>')
    .replace(/(&#39;|')([^']*?)(&#39;|')/g, '<span class="text-emerald-400">\'$2\'</span>')
    .replace(/(https?:\/\/[^\s\\]+)/g, '<span class="text-emerald-400">$1</span>');
}

function highlightTypeScript(code: string): string {
  const escaped = code
    .replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;');
  return escaped
    .replace(/\b(import|from|const|new|await)\b/g, '<span class="text-violet-400">$1</span>')
    .replace(/"([^"]*)"/g, '<span class="text-emerald-400">"$1"</span>')
    .replace(/\b(\d+)\b/g, '<span class="text-cyan-400">$1</span>')
    .replace(/(\{|\}|\(|\)|;|,|:)/g, '<span class="text-gray-400">$1</span>')
    .replace(/(\.\w+)/g, '<span class="text-cyan-300">$1</span>');
}

function highlight(code: string, language: string): string {
  if (language === 'json') return highlightJson(code);
  if (language === 'bash') return highlightBash(code);
  if (language === 'typescript') return highlightTypeScript(code);
  return code;
}

const tabs = [
  {
    id: "claude",
    label: "Claude Desktop",
    language: "json",
    code: `{
  "mcpServers": {
    "nightlife": {
      "url": "https://api.nightlife.dev/mcp",
      "headers": {
        "x-api-key": "YOUR_API_KEY"
      }
    }
  }
}`,
  },
  {
    id: "curl",
    label: "curl",
    language: "bash",
    code: `curl https://api.nightlife.dev/mcp \\
  -H 'content-type: application/json' \\
  -H 'accept: application/json, text/event-stream' \\
  -H 'x-api-key: YOUR_API_KEY' \\
  -d '{
    "jsonrpc": "2.0",
    "id": 1,
    "method": "tools/call",
    "params": {
      "name": "get_tonight",
      "arguments": { "city": "tokyo" }
    }
  }'`,
  },
  {
    id: "typescript",
    label: "TypeScript",
    language: "typescript",
    code: `import { Client } from "@modelcontextprotocol/sdk/client/index.js";
import { StreamableHTTPClientTransport } from "@modelcontextprotocol/sdk/client/streamableHttp.js";

const transport = new StreamableHTTPClientTransport(
  new URL("https://api.nightlife.dev/mcp"),
  { requestInit: { headers: { "x-api-key": "YOUR_API_KEY" } } }
);

const client = new Client({ name: "my-app", version: "1.0.0" });
await client.connect(transport);

const result = await client.callTool({
  name: "get_tonight",
  arguments: { city: "tokyo", limit: 5 }
});`,
  },
].map(tab => ({ ...tab, highlighted: highlight(tab.code, tab.language) }));
---

<section id="connect" class="py-20 md:py-28">
  <div class="mx-auto max-w-4xl px-6">
    <div class="mb-12 text-center">
      <h2 class="mb-4 text-3xl font-bold tracking-tight md:text-4xl">
        Connect in seconds
      </h2>
      <p class="mx-auto max-w-2xl text-text-muted">
        Add the nightlife MCP server to Claude Desktop, call it from curl, or
        use the TypeScript SDK. No complex setup required.
      </p>
    </div>

    <div class="rounded-xl border border-border bg-bg-card overflow-hidden">
      <!-- Tabs -->
      <div class="flex border-b border-border" role="tablist">
        {
          tabs.map((tab, i) => (
            <button
              role="tab"
              aria-selected={i === 0 ? "true" : "false"}
              aria-controls={`panel-${tab.id}`}
              data-tab={tab.id}
              class:list={[
                "connect-tab px-5 py-3 text-sm font-medium transition-colors",
                i === 0
                  ? "border-b-2 border-primary text-text"
                  : "text-text-muted hover:text-text",
              ]}
            >
              {tab.label}
            </button>
          ))
        }
      </div>

      <!-- Panels -->
      {
        tabs.map((tab, i) => (
          <div
            id={`panel-${tab.id}`}
            role="tabpanel"
            class:list={["connect-panel", i !== 0 && "hidden"]}
          >
            <pre class="overflow-x-auto p-6 text-sm leading-relaxed font-mono"><code set:html={tab.highlighted} /></pre>
          </div>
        ))
      }
    </div>
  </div>
</section>

<script>
  document.querySelectorAll(".connect-tab").forEach((tab) => {
    tab.addEventListener("click", () => {
      const targetId = (tab as HTMLElement).dataset.tab;

      document.querySelectorAll(".connect-tab").forEach((t) => {
        t.setAttribute("aria-selected", "false");
        t.classList.remove("border-b-2", "border-primary", "text-text");
        t.classList.add("text-text-muted");
      });

      tab.setAttribute("aria-selected", "true");
      tab.classList.add("border-b-2", "border-primary", "text-text");
      tab.classList.remove("text-text-muted");

      document.querySelectorAll(".connect-panel").forEach((p) => {
        p.classList.add("hidden");
      });
      document.getElementById(`panel-${targetId}`)?.classList.remove("hidden");
    });
  });
</script>
