---
import AuthPage from "../layouts/AuthPage.astro";
---

<AuthPage title="Sign Up â€” nightlife.dev" heading="Create your account">
  <form id="signup-form" class="space-y-4">
    <div>
      <label for="email" class="mb-1 block text-sm font-medium">Email</label>
      <input
        id="email"
        type="email"
        required
        autocomplete="email"
        placeholder="you@example.com"
        class="w-full rounded-lg border border-border bg-bg px-3 py-2.5 text-sm text-text placeholder-text-muted outline-none transition-colors focus:border-primary"
      />
    </div>

    <div>
      <label for="password" class="mb-1 block text-sm font-medium">Password</label>
      <input
        id="password"
        type="password"
        required
        minlength="6"
        autocomplete="new-password"
        placeholder="Min. 6 characters"
        class="w-full rounded-lg border border-border bg-bg px-3 py-2.5 text-sm text-text placeholder-text-muted outline-none transition-colors focus:border-primary"
      />
    </div>

    <div id="error-msg" class="hidden rounded-lg bg-red-500/10 px-3 py-2 text-sm text-red-400">
    </div>

    <div
      id="success-msg"
      class="hidden rounded-lg bg-green-500/10 px-3 py-2 text-sm text-green-400"
    >
      Check your email for a confirmation link.
    </div>

    <button
      type="submit"
      id="submit-btn"
      class="w-full rounded-lg bg-primary py-2.5 text-sm font-medium text-white transition-colors hover:bg-primary-hover disabled:opacity-50"
    >
      Create account
    </button>
  </form>

  <p class="mt-6 text-center text-sm text-text-muted">
    Already have an account?
    <a href="/login" class="text-primary hover:underline">Log in</a>
  </p>
</AuthPage>

<script>
  import { supabase } from "../lib/supabase";

  const form = document.getElementById("signup-form") as HTMLFormElement;
  const emailInput = document.getElementById("email") as HTMLInputElement;
  const passwordInput = document.getElementById("password") as HTMLInputElement;
  const errorMsg = document.getElementById("error-msg") as HTMLDivElement;
  const successMsg = document.getElementById("success-msg") as HTMLDivElement;
  const submitBtn = document.getElementById("submit-btn") as HTMLButtonElement;

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    errorMsg.classList.add("hidden");
    successMsg.classList.add("hidden");
    submitBtn.disabled = true;
    submitBtn.textContent = "Creating account...";

    const { error } = await supabase.auth.signUp({
      email: emailInput.value,
      password: passwordInput.value,
    });

    if (error) {
      errorMsg.textContent = error.message;
      errorMsg.classList.remove("hidden");
      submitBtn.disabled = false;
      submitBtn.textContent = "Create account";
    } else {
      successMsg.classList.remove("hidden");
      form.classList.add("hidden");
    }
  });
</script>
